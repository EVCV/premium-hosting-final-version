---
import Hero from '../components/sections/Hero.astro';
import HostingHero from '../components/sections/HostingHero.astro';
import Features from '../components/sections/Features.astro';
import Sponsors from '../components/sections/Sponsors.astro';
import Services from '../components/sections/Services.astro';
import Team from '../components/sections/Team.astro';
import Testimonials from '../components/sections/Testimonials.astro';
import Cases from '../components/sections/Cases.astro';
import Contact from '../components/sections/Contact.astro';
import PricingSection from '../templates/sections/PricingSection.astro';
import PostContent from '../templates/sections/PostContent.astro';

interface SectionConfig {
  id: string;
  component: string;
  props?: Record<string, any>;
}

interface TemplateConfig {
  layout: string;
  sections: SectionConfig[];
}

interface Props {
  template: TemplateConfig;
  data?: Record<string, any>;
}

const { template, data } = Astro.props;

// Component registry for direct access (matches template.json naming)
const components = {
  HeroSection: Hero,
  HostingHeroSection: HostingHero,
  FeaturesSection: Features,
  SponsorsSection: Sponsors,
  ServicesSection: Services,
  TeamSection: Team,
  TestimonialsSection: Testimonials,
  CasesSection: Cases,
  ContactSection: Contact,
  PricingSection,
  PostContent
};
---2

<div class="template-renderer">
  {template.sections.map((section: SectionConfig) => {
    const Component = components[section.component as keyof typeof components];

    if (!Component) {
      console.warn(`Component not found: ${section.component}`);
      // Fallback: show the section name for debugging
      return (
        <div id={section.id} class={`section section-${section.id} p-8 bg-red-100 border-2 border-red-300`}>
          <h2 class="text-red-800 font-bold">Component "{section.component}" not found</h2>
          <p class="text-red-600">This section should be implemented</p>
          <code class="mt-2 text-sm text-red-500">Component: {section.component}</code>
        </div>
      );
    }

    // Provide default props for components that need them
    const defaultProps: any = section.component === 'PricingSection' ? { plans: [] } : {};
    const mergedProps = { ...defaultProps, ...section.props, ...data };
    
    return (
      <div id={section.id} class={`section section-${section.id}`}>
        {Component && <Component {...mergedProps} />}
      </div>
    );
  })}
</div>

<style>
  .template-renderer {
    width: 100%;
  }

  .section {
    width: 100%;
  }
</style>

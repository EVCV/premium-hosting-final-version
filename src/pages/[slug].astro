---
import { getPages, getPageBySlug } from '../utils/wordpress-client';
import BaseTemplate from '../templates/layouts/BaseTemplate.astro';
import TemplateRenderer from '../components/TemplateRenderer.astro';
import templates from '../data/templates.json';

export async function getStaticPaths() {
  try {
    const pagesData = await getPages(100);

    return pagesData.pages.nodes.map((page: any) => ({
      params: { slug: page.slug },
      props: { page },
    }));
  } catch (error) {
    console.error('Error fetching WordPress pages:', error);
    // Return empty array for now - will fallback to static content
    return [];
  }
}

const { slug } = Astro.params;
let page = null;

try {
  page = await getPageBySlug(slug);
} catch (error) {
  console.error(`Error fetching page ${slug}:`, error);
}

// Get template config (default to base if not found)
const templateKey = slug === 'about' ? 'about' : 'base';
const templateConfig = (templates as any)[templateKey] || (templates as any).base;

// Pass page data to template
const pageData = page ? {
  title: page.page.title,
  content: page.page.content,
  slug: page.page.slug,
} : {
  title: `Page: ${slug}`,
  content: '<div>Loading...</div>',
  slug: slug,
};
---

<BaseTemplate title={pageData.title} description={pageData.content}>
  <TemplateRenderer template={templateConfig} data={pageData} />
</BaseTemplate>
